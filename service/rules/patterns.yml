# A. DEADLINES (absolute and relative)

- id: absolute_deadline_iso
  priority: 60
  regex: '\b(?:CANCEL(?:LATION)?\s+BY|CANCEL\s+BY|BY)\s+(?<iso>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})\b'
  map:
    deadline.type: absolute
    deadline.iso: $iso

# "BY/AFTER/UNTIL 1800 11NOV" (optionally with year like 11NOV25)
- id: absolute_deadline_ddmon_variants
  priority: 60
  regex: '\b(?:BY|AFTER|UNTIL)\s+(?<hh>\d{3,4})\s+(?<d1>\d{1,2})(?<mon>JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)(?<yy>\d{2})?\b'
  map:
    deadline.type: absolute
    deadline.local_hour: $hh
    deadline.date_ddmmmyy: $d1$mon$yy
    deadline.date_ddmon: $d1$mon

# "2 DAYS PRIOR/BEFORE ARR(IVAL)"
- id: relative_cutoff_days_to_arrival
  priority: 65
  regex: '\b(?<days>\d+)\s*DAYS?\s*(PRIOR|BEFORE)\s*(?:TO\s*)?(?:ARR(IVAL)?)\b'
  map:
    deadline.type: relative
    deadline.relation: to_arrival
    deadline.relative_days: $days
    window.cutoff_days: $days

# "24H/24HRS PRIOR TO ARR" etc. (normalized to days via ceil)
- id: relative_cutoff_hours_to_arrival
  priority: 65
  regex: '\b(?<h>\d+)\s*H(?:RS?|OURS?)?\s*(PRIOR|BEFORE)\s*(?:TO\s*)?(?:ARR(IVAL)?)\b'
  map:
    deadline.type: relative
    deadline.relation: to_arrival
    deadline.relative_hours: $h
    window.cutoff_days: "ceil($h/24)"

# B. FEES / PENALTIES

# Amount + currency + label appears later somewhere
- id: fee_fixed_amount_trailing_label
  priority: 80
  regex: '\b(?<amount>\d{1,3}(?:[.,]\d{3})*(?:[.,]\d+)?|\d+(?:[.,]\d+)?)\s*(?<currency>HKD|USD|CNY|JPY|EUR|GBP|MOP|SGD|THB|TWD|IDR|VND|AUD|CAD)\b.*?\b(FEE|PENALTY|AMOUNT)\b'
  map:
    fee.type: fixed_amount
    fee.amount: $amount
    fee.currency: $currency

# Label first → amount (currency optional after)
- id: fee_amount_after_label
  priority: 80
  regex: '\b(CXL\s+FEE|FEE|PENALTY|AMOUNT)\b[^\dA-Z]{0,20}(?<amount>\d{1,3}(?:[.,]\d{3})*(?:[.,]\d+)?|\d+(?:[.,]\d+)?)(?:\s*(?<currency>HKD|USD|CNY|JPY|EUR|GBP|MOP|SGD|THB|TWD|IDR|VND|AUD|CAD))?\b'
  map:
    fee.type: fixed_amount
    fee.amount: $amount
    fee.currency: $currency

# Label first → currency first → amount
- id: fee_amount_after_label_currency_first
  priority: 80
  regex: '\b(CXL\s+FEE|FEE|PENALTY|AMOUNT)\b[^\dA-Z]{0,20}(?<currency>HKD|USD|CNY|JPY|EUR|GBP|MOP|SGD|THB|TWD|IDR|VND|AUD|CAD)\s*(?<amount>\d{1,3}(?:[.,]\d{3})*(?:[.,]\d+)?|\d+(?:[.,]\d+)?)\b'
  map:
    fee.type: fixed_amount
    fee.amount: $amount
    fee.currency: $currency

# "FORFEIT FIRST NITE/NIGHT"
- id: fee_forfeit_first_night
  priority: 75
  regex: '\bFORFEIT\s+FIRST\s+NI?TE\b'
  map:
    fee.type: nights_penalty
    fee.nights: 1

# Generic nights penalty e.g., "1NT", "2 NIGHTS"
- id: fee_nights_generic
  priority: 75
  regex: '\b(?<nights>\d+)\s*(?:NIGHTS?|NT|NITE)\b'
  map:
    fee.type: nights_penalty
    fee.nights: $nights

# Percentage penalty e.g., "100 PCT", "50%"
- id: fee_percentage
  priority: 75
  regex: '\b(?<percent>\d{1,3})\s*(?:%|PCT)\b'
  map:
    fee.type: percentage
    fee.percent: $percent

# Non-refundable flag
- id: fee_non_refundable
  priority: 90
  regex: '\bNON-?REFUNDABLE|NON-?AMENDABLE\b'
  map:
    fee.type: non_refundable
